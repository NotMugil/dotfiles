"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7564],{97927:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Ts});var i=a(79474),t=a(72506),n=a(89770),r=a(14056),l=a(59560),c=a(88713),d=a(51765),o=a(89063),u=a(46593),m=a(60181),x=a(36471),f=a(42360),h=a(14494),j=a(67302),g=a(23659),b=a(98764),p=a(61080),N=a(27977),y=a(98258),v=a(59841),C=a(99139);let k=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});var S=a(98678),E=a(26013),R=a(10801),w=a(28049);var L=a(97500),I=a.n(L),T=a(23689),O=a(37128),B=a(29969),D=a(26229),P=a(32247);const _="jmX3vUTqdroySvWZjafY",A="sy4ejRXtpCCm2rnVCsBh",F="HO7uMcLeIpPBUBfBUF7f",U="EWRfCzpvY8DGEJrpWuib";var Q=a(13274);const z=({name:e,following:s,imageUrl:a,uri:n})=>{const c=(0,D.f)(),d=(0,x.W)(),o=i.createRef(),[u,m]=(0,i.useState)(s);(0,P.N)(B.mc.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case B.JK.FOLLOW_USER:m(!0);break;case B.JK.UNFOLLOW_USER:m(!1)}}));const f=(0,i.useCallback)((()=>{u?c.unfollowUsers([n]):(c.followUsers([n]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),o.current&&o.current.blur()}),[u,o,n,c,d]);return(0,i.useEffect)((()=>{m(s)}),[s]),(0,Q.jsxs)("div",{className:_,children:[(0,Q.jsx)(O.e,{label:e,width:40,userIconSize:"small",images:(0,i.useMemo)((()=>[{width:40,height:40,url:a}]),[a])}),(0,Q.jsxs)("div",{className:I()(A,"ellipsis-one-line"),children:[(0,Q.jsx)(b.E,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),u&&(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:r.Ru.get("following")})]}),(0,Q.jsx)("div",{className:F,children:(0,Q.jsx)(l.a,{className:U,size:"sm",ref:o,onClick:f,ariaLabel:u?r.Ru.get("buddy-feed.button.remove-friend"):r.Ru.get("buddy-feed.button.add-friend"),icon:u?T.M:t.k})})]})},M="rnrQ23E2_XN8d7ZBqsTp";function Y({facebookFriends:e}){return(0,Q.jsx)("div",{className:M,children:e.map((({uri:e,following:s,title:a,image:i})=>(0,Q.jsx)(z,{uri:e,name:a,imageUrl:i,following:s},`fb-friend-${e}`)))})}const W="eGd6xxi5CmL4GBZoEnMi";function Z(){return(0,Q.jsx)("div",{className:W,children:Array(20).fill(0).map(((e,s)=>(0,Q.jsx)(R.Y,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}const H="wFKGrAXEW5REryzTsDIb",G="Na5e2ZRRgwg_8duvoFyo",J="sgUgGj3mSuAdpNv8AyYQ",V="ePqfotL3LdZXKKlsSp1G",X="Jxd3auUMXwsqpPcizfbP",q="KPTOp08r5MTyYMmcTBcM",K="uaVnv8WopjiEsa4Hpl_r",$="eI_jytcKj_NBe3vo5mvx",ee="CxoJJA7kFeXzEeE2R6f7",se=({onBackButtonClick:e})=>{const[s,a]=(0,i.useState)(""),{isLoading:t,friends:n}=(e=>{const s=(0,C.C)(),a=e.trim().toLowerCase(),{data:i,isLoading:t}=(0,w.I)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:t,friends:i?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(a)))??[]}})(s),c=(0,S.YQ)((e=>{a(e.target.value)}),100),d=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,Q.jsxs)("div",{className:H,children:[(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:e,ref:d,className:G,icon:g.g,size:"sm",testId:"back-to-friends"}),(0,Q.jsxs)("div",{className:J,children:[(0,Q.jsx)("div",{className:V,children:(0,Q.jsx)(N.G,{className:X,size:"large"})}),(0,Q.jsx)("div",{className:q,children:t?(0,Q.jsx)(R.Y,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",children:r.Ru.get("buddy-feed.number-of-friends",n.length)})})]}),t?(0,Q.jsx)(Z,{}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)("div",{className:K,children:[(0,Q.jsx)(E.C,{className:ee,size:"small",role:"presentation"}),(0,Q.jsx)("input",{onChange:c,className:$,placeholder:r.Ru.get("buddy-feed.find-in-playlists")})]}),(0,Q.jsx)(Y,{facebookFriends:n})]})]})};var ae=a(45132);function ie({isOpen:e,onClose:s,onConfirm:a}){return(0,Q.jsx)(ae.T,{onClose:s,"aria-label":r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:a,titleText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:r.Ru.get("queue.cancel-button"),confirmText:r.Ru.get("web-player.buddy-feed.connect-button"),isOpen:e})}const te="PWrXmnQx41DSpIe1D_nH",ne="AzWuuC6HtstaRZSyCs3n",re="VrSCtYccvuQZG9aY627D",le="mSFjqxw0tzcwc0ZCN1YP",ce="Q9ZfLJTBuMTFz4HsBThH",de="_76MQUYO_OcYkQOL1dlw",oe="TOY_wX6BMTOxtaEcJX2X",ue="A_pGgx3U5jNWUM85mJLQ",me="ffXJrzSIg2CXoGlxDi0v",xe="zmmtwzKSFa5srnl7Ftq2",fe=e=>{const s=(0,x.W)(),{onBackButtonClick:a,feedIsEmpty:t,goToAddFriends:n=!1}=e,c=function(){const e=(0,C.C)(),[s,a]=(0,i.useState)(k.LOADING);return(0,i.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?k.CONNECTED:k.DISCONNECTED)})).cancel),[e]),s}(),d=(0,C.C)(),[o,u]=(0,i.useState)(!1),[m,f]=(0,i.useState)(!1),[h,j]=(0,i.useState)(!1),S=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]),E=(0,i.useCallback)((()=>{location.reload()}),[]);if(m)return(0,Q.jsxs)("div",{className:me,children:[(0,Q.jsx)(l.a,{onClick:a,ref:S,className:re,ariaLabel:r.Ru.get("buddy-feed.button.back"),icon:g.g,size:"sm"}),(0,Q.jsxs)("div",{className:xe,children:[(0,Q.jsx)(b.E,{as:"h1",variant:"bodyMediumBold",className:ne,children:r.Ru.get("error-dialog.generic.header")}),(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",className:le,children:r.Ru.get("error-dialog.generic.body")}),(0,Q.jsx)(p.$,{colorSet:"invertedLight",onClick:E,children:r.Ru.get("error.reload")})]})]});const R=(n||h)&&c===k.CONNECTED;return(0,Q.jsxs)("div",{className:te,children:[R&&(0,Q.jsx)(se,{onBackButtonClick:()=>{t&&j(!1),a()}}),!R&&(0,Q.jsxs)("div",{className:de,children:[(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:a,className:re,ref:S,icon:g.g,size:"sm"}),(0,Q.jsx)(b.E,{as:"h1",variant:"bodyMediumBold",className:ne,children:r.Ru.get("buddy-feed.friend-activity")}),(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",className:le,children:r.Ru.get("buddy-feed.facebook.connect-with-friends-default")}),(0,Q.jsx)("div",{className:oe,children:(0,Q.jsx)(p.$,{className:ue,size:"small",iconLeading:N.G,UNSAFE_colorSet:(0,y.mA)("#2374E1",v.white),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==k.CONNECTED?u(!0):j(!0)},children:r.Ru.get("buddy-feed.facebook.button")})}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:ce,children:r.Ru.get("buddy-feed.facebook.disclaimer")}),(0,Q.jsx)(ie,{isOpen:o,onClose:()=>{u(!1)},onConfirm:()=>{d.connectToFacebook().then((()=>{j(!0),u(!1)})).catch((()=>{f(!0)}))}})]})]})};var he=a(60096),je=a(43204);const ge="jGcEaPyhr1c_janM2uRF",be="OemaZktMXaRcYQ5bcfLZ",pe="o5IJsOJEWBEyxtPVVVqQ",Ne="yHlSWaHkqZHm5mcY8ZFh",ye="toPt7VOT_PiDx5Gj3SM2",ve="xU4sacBisQneHoQeHMP5",Ce="srjSlmxMGzXnJBc32BJa",ke="lju7xv10a5Y5Z8h8CcKJ",Se="jr794VV4i2iUBRhfvS5i",Ee="KE3gK5ccLz2gL3dhJ4BW",Re="pO2rsGFqUdaNhpLrif21",we="Ydxgl4Y23orfVVVI9O2k",Le="VhqWrkzIrJrvdyj7ZXMd",Ie="T3liC_3fbMOTilR4HHKD",Te="W_tr6AMQB9Chbc9bCS9w",Oe="yDdNxgieZmqjgHQCW3UE",Be="iRrzzadYGo2MSuVhmVCn",De="_8yOZhEqs2xrYtslnNcDw",Pe="aikUDGtqRnCX0ZwYHDUW",_e="T_HXMW6n5qsbLbPTr1GS",Ae="tYswKV9PmtTCv62LOPIV",Fe="GlDNRQ2w0t4h9WBI4GgN",Ue="BQGSV5BvuAaJ5rmFAXLp",Qe="ZLbFjRdp1AMXebZH6UWM",ze="jhtyHt6d9vbxK6VtCI7a",Me="oCaGCB13zdReRutfBS8_",Ye="MR1n58Qu0kPorQtveOCQ",We="y10vXronmQ6eYMlJrIp3",Ze=({showOnlineIndicator:e})=>(0,Q.jsxs)("div",{className:Ae,children:[(0,Q.jsxs)("div",{className:Fe,children:[(0,Q.jsx)(je.v,{size:"medium"}),e?(0,Q.jsx)("div",{className:Ue}):null]}),(0,Q.jsxs)("div",{className:Qe,children:[(0,Q.jsx)("div",{className:I()(ze,Me)}),(0,Q.jsx)("div",{className:ze}),(0,Q.jsx)("div",{className:ze})]})]}),He=()=>(0,Q.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:Pe,children:[(0,Q.jsx)(b.E,{as:"p",className:_e,children:r.Ru.get("buddy-feed.let-followers-see-your-listening")}),(0,Q.jsx)(Ze,{showOnlineIndicator:!0}),(0,Q.jsx)(Ze,{showOnlineIndicator:!0}),(0,Q.jsx)(Ze,{}),(0,Q.jsx)(b.E,{as:"p",className:_e,children:r.Ru.get("buddy-feed.enable-share-listening-activity")}),(0,Q.jsx)(he.N_,{to:"/preferences",className:Ye,children:(0,Q.jsx)(p.$,{colorSet:"invertedLight",className:We,children:r.Ru.get("desktop.settings.settings")})})]});var Ge=a(77173),Je=a(50042),Ve=a(68083),Xe=a(40091),qe=a(83856),Ke=a(88291),$e=a(84387),es=a(59416),ss=a(69494),as=a(63445),is=a(41955),ts=a(98496),ns=a(30957),rs=a(54745),ls=a(2092),cs=a(8955),ds=a(95999),os=a(26271),us=a(9440),ms=a(64463),xs=a(45916);const fs=e=>{const{timestamp:s,isNowPlaying:a}=e;return a?(0,Q.jsx)(c.Zp,{label:r.Ru.get("time.now"),children:(0,Q.jsx)(ms.A,{"aria-label":r.Ru.get("time.now"),size:"small"})}):(0,Q.jsx)("span",{children:(0,xs.Z)(s)})},hs=e=>Date.now()-e<9e5,js=(e,s)=>{const a=(0,qe.o_)(e)?.type;switch(a){case qe.NQ.PLAYLIST:case qe.NQ.PLAYLIST_V2:return(0,Q.jsx)(ss.W,{uri:e});case qe.NQ.EPISODE:case qe.NQ.SHOW:return(0,Q.jsx)(as.H,{uri:e});case qe.NQ.ALBUM:return(0,Q.jsx)($e.h,{uri:e,artistUri:s});case qe.NQ.ARTIST:return(0,Q.jsx)(es.t,{uri:e});default:return null}},gs=e=>{switch(e){case qe.NQ.ALBUM:return us.c.ALBUM;case qe.NQ.ARTIST:return us.c.ARTIST;case qe.NQ.SHOW:return us.c.SHOW;case qe.NQ.EPISODE:return us.c.EPISODE;case qe.NQ.PLAYLIST:case qe.NQ.PLAYLIST_V2:return us.c.PLAYLIST;default:return}},bs=e=>{const{show:s=!0,spec:a,friend:t}=e,n=(0,i.useMemo)((()=>t.user.imageUrl?[{url:t.user.imageUrl,width:0,height:0}]:[]),[t.user.imageUrl]),l=(0,x.W)(),c=(0,h.s)(),d=t.track,o=d.uri,{togglePlay:u,isPlaying:m,isActive:f}=(0,os.P)({uri:o},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),j=(0,qe.o_)(d.context?.uri),g=j?.type,p=(0,i.useCallback)((()=>{u(),l({intent:m?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=a.friendRowFactory().playButtonFactory();f?m?c.logInteraction(e.hitPause({itemToBePaused:o})):c.logInteraction(e.hitResume({itemToBeResumed:o})):c.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[l,m,o,a,f,u,c]),N=(0,i.useCallback)(((e,s)=>{c.logInteraction(a.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,a]),{draggable:y,onDragStart:v}=(0,ls.P)({itemUris:[o],dragLabelText:d.name}),{draggable:C,onDragStart:k}=(0,ls.P)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),{draggable:S,onDragStart:E}=(0,ls.P)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,Q.jsxs)("div",{className:I()(ge),children:[(0,Q.jsx)(Ke.h,{menu:js(d.context?.uri,d.artist?.uri),children:(0,Q.jsxs)("div",{className:ve,children:[(0,Q.jsx)(O.e,{label:t.user.name,width:40,userIconSize:"small",images:n,withBadge:hs(t.timestamp)}),(0,Q.jsx)(rs.x,{className:Ce,iconClassName:ke,isPlaying:m,isLocked:!1,onClick:p,playAriaLabel:m?r.Ru.get("pause"):`${r.Ru.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,Q.jsxs)("div",{className:I()(Se),children:[(0,Q.jsxs)("div",{className:Ee,children:[(0,Q.jsx)(b.E,{as:"p",variant:"bodySmallBold",className:I()(Re,"ellipsis-one-line"),children:(0,Q.jsx)(ds.pZ,{value:"/buddyfeed_user_profile",children:(0,Q.jsx)(Ke.h,{menu:(0,Q.jsx)(ts.B,{uri:t.user.uri}),children:(0,Q.jsx)(ns.Link,{title:t.user.name,to:t.user.uri,dir:"auto",onClick:()=>N("profile_link",t.user.uri),children:t.user.name})})})}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:I()(we),children:(0,Q.jsx)(fs,{timestamp:t.timestamp,isNowPlaying:hs(t.timestamp)})})]}),(0,Q.jsxs)(b.E,{as:"p",variant:"marginal",className:Le,children:[(0,Q.jsx)(ds.pZ,{value:"/buddyfeed_track",children:(0,Q.jsx)(Ke.h,{menu:(0,Q.jsx)(is.P,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,Q.jsx)(ns.Link,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:y,onDragStart:v,onClick:()=>N("track_link",o),children:d.name})})}),(0,Q.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,Q.jsx)(ds.pZ,{value:"/buddyfeed_artist",children:(0,Q.jsx)(Ke.h,{menu:d.artist?(0,Q.jsx)(es.t,{uri:d.artist.uri}):null,children:(0,Q.jsx)(ns.Link,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:C,onDragStart:k,onClick:()=>N("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:I()("ellipsis-one-line",Te),children:(0,Q.jsx)(ds.pZ,{value:"/buddyfeed_context",children:(0,Q.jsx)(Ke.h,{menu:js(d.context?.uri,d.artist?.uri),children:(0,Q.jsxs)(ns.Link,{title:d.context?.name,to:d.context?.uri,className:Oe,draggable:S,onDragStart:E,onClick:()=>N("context_link",d.context?.uri),children:[(0,Q.jsx)(cs.s,{type:gs(g),iconSize:16,className:Ie}),(0,Q.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},t.user.uri):null};function ps({friends:e,spec:s}){const{currentSession:a}=(0,Je.D)(),t=(0,Xe.y)(),[n,r]=(0,i.useState)(!0),l=!a?.active&&t&&n&&(0,Q.jsx)("li",{className:pe,children:(0,Q.jsx)(Ve.p,{localStorageKey:"dismissStartJamButtonFromFriendFeed",onDismiss:()=>r(!1)})},"start-jam-button");return(0,Q.jsx)(Ge.ZI,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,Q.jsxs)("ul",{className:be,children:[l,e.map(((e,a)=>(0,Q.jsx)(Ge.lf,{flipId:e.user.uri,children:(0,Q.jsx)("li",{children:(0,Q.jsx)(bs,{friend:e,show:a<100,spec:s},e.user.uri)})},e.user.uri)))]})})}var Ns=a(66535),ys=a(29439);const vs="VTOHA2pQ5UOAQhut6swb",Cs="y02ezh9Bcfm_61XcxvOS",ks="rb6j61g6Avhg8RARvz3b",Ss="xDW2awz1Oc3Khs6Wsn8g",Es="MOKoNTiYkc9jh0xhfoZH",Rs="gOHEpGu2st4QQtJy8OPw",ws="ijngDXlnRFRYySzwV5JJ",Ls="oNiqjPtyJeYH6LqZlnVa",Is=({children:e,page:s})=>{const a=0===s,i=e.filter(((e,a)=>a!==s));return(0,Q.jsx)(Ns.A,{component:null,children:i.map((e=>(0,Q.jsx)(ys.A,{in:a,timeout:500,classNames:{enter:a?vs:Es,enterActive:a?Cs:Rs,exit:a?ks:ws,exitActive:a?Ss:Ls},children:e},a?"first-page":"second-page")))})},Ts=({friends:e})=>{const s=(0,x.W)(),a=(0,h.s)(),{spec:g}=(0,j.r)(n.W,{});(0,i.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,i.useEffect)((()=>{a.logImpression(g.impression())}),[a,g]);const[b,p]=(0,i.useState)(!1),N=()=>{b||a.logInteraction(g.addFriendButtonFactory().hitUiReveal()),p(!b)},y=0===e.length,v=(0,i.useCallback)((()=>{a.logInteraction(g.closeButtonFactory().hitUiHide())}),[a,g]);return(0,Q.jsx)(f.ql.Provider,{value:"buddy_feed",children:(0,Q.jsx)(d._,{label:r.Ru.get("buddy-feed.friend-activity"),focusTransferId:"BUDDY-FEED",children:(0,Q.jsxs)(Is,{page:b?1:0,children:[(0,Q.jsx)("div",{className:Ne,children:(0,Q.jsx)(fe,{onBackButtonClick:N,feedIsEmpty:y,goToAddFriends:b})}),(0,Q.jsx)("div",{className:ye,children:(0,Q.jsxs)(o.w,{children:[(0,Q.jsx)(u.a,{title:r.Ru.get("buddy-feed.friend-activity"),panel:m.Z.BuddyFeed,onClose:v,actions:(0,Q.jsx)(c.Zp,{label:r.Ru.get("buddy-feed.add-friends"),children:(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:N,icon:t.k})})}),(0,Q.jsx)("div",{className:Be,children:(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),className:De,size:"sm",onClick:N,icon:t.k})}),y?(0,Q.jsx)(He,{}):(0,Q.jsx)(ps,{friends:e,spec:g})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map